version: "1.0"
namespace: userspace.dataflow.node.map_reduce

entries:
  # userspace.dataflow.node.map_reduce:iterator
  - name: iterator
    kind: library.lua
    meta:
      name: Iteration Manager
      comment: Manages iteration node creation, UUID mapping, and result collection
      tags:
        - dataflow
        - map-reduce
        - iteration
        - nodes
        - uuid
        - results
      description: |
        Handles the lifecycle of map-reduce iterations including node creation with
        UUID remapping, input data routing, and result collection. Encapsulates
        the complex state management required for parallel iteration execution.
    source: file://iterator.lua
    modules:
      - uuid
    imports:
      consts: userspace.dataflow:consts
      data_reader: userspace.dataflow.persist:data_reader
    
  # userspace.dataflow.node.map_reduce:iterator_test
  - name: iterator_test
    kind: function.lua
    meta:
      name: Iterator Tests
      type: test
      comment: Unit tests for iteration management and node lifecycle
      group: Workflow / Map-Reduce
      tags:
        - dataflow
        - map-reduce
        - iteration
        - nodes
        - tests
      description: |
        Tests iteration creation, UUID remapping, node creation commands,
        input data routing, and result collection mechanisms.
    source: file://iterator_test.lua
    modules:
      - uuid
      - json
    imports:
      consts: userspace.dataflow:consts
      iterator: userspace.dataflow.node.map_reduce:iterator
      test: wippy.test:test
    method: run_tests
    
  # userspace.dataflow.node.map_reduce:map_reduce
  - name: map_reduce
    kind: process.lua
    meta:
      name: Map-Reduce Node
      comment: Parallel map-reduce execution node for dataflow workflows
      tags:
        - dataflow
        - node
        - map-reduce
        - parallel
        - batch
        - template
      description: |
        Advanced dataflow node that implements map-reduce pattern with template-based
        child node execution. Supports batching, multiple failure strategies, dependency
        graphs between templates, and optional result reduction. Handles complex parallel
        execution scenarios with proper error propagation and result aggregation.
      default_host: app:processes
    source: file://map_reduce.lua
    modules:
      - funcs
    imports:
      consts: userspace.dataflow:consts
      iterator: userspace.dataflow.node.map_reduce:iterator
      node: userspace.dataflow:node
      template_graph: userspace.dataflow.template:graph
    method: run
    
  # userspace.dataflow.node.map_reduce:map_reduce_test
  - name: map_reduce_test
    kind: function.lua
    meta:
      name: Map-Reduce Tests
      type: test
      comment: Comprehensive unit and integration tests for map-reduce functionality
      group: Workflow / Map-Reduce
      tags:
        - dataflow
        - node
        - map-reduce
        - tests
        - mocking
        - integration
      description: |
        Comprehensive tests for map-reduce functionality including configuration
        validation, input processing, template discovery, batch execution, failure
        strategies, reducer application, and end-to-end integration workflows.
        Combines both unit tests with mocking and real integration tests.
    source: file://map_reduce_test.lua
    modules:
      - uuid
      - json
    imports:
      client: userspace.dataflow:client
      consts: userspace.dataflow:consts
      data_reader: userspace.dataflow.persist:data_reader
      map_reduce: userspace.dataflow.node.map_reduce:map_reduce
      test: wippy.test:test
    method: run_tests
    